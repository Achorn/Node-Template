extends base 
include _reviewCard




block append head
  //- scripts for leaflet mapping
  link(rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin="")

mixin reviewCard(review)
  h4 hello
  .reviews__card
    .reviews__avatar
      //- img.reviews__avatar-img(src=`/img/users/${review.user.photo}`, alt=review.user.name)
      h6.reviews__user= review.user.name
      p.reviews__text= review.review
    .reviews__rating
      each star in [1,2,3,4,5]
        svg.reviews__star(class=`reviews__star--${review.rating >= star? 'active':'inactive'}`)
          use(xlink:href='/img/icons.svg#icon-star')


mixin relationshipButton(user,relationship)
 -console.log(relationship)
 
  div.log--container
    if user
      if relationship 
        button#logBtn(disabled).dropbtn= `${relationship.experience}`
      else
        button#logBtn( data-game=game.guid data-experience='want-to-play' data-rest='POST').dropbtn Want to Play
      div.dropdown
        button#dropbtn.dropbtn V
        div#myDropdown.dropdown-content
          if !relationship || relationship.experience ==='played'
            a#wantToPlayUpdate.dropbtn( data-game=game.guid data-relationship=relationship?relationship.id:undefined data-experience="want-to-play" data-rest=`${relationship? 'PATCH':"POST"}`) Want to play
          if !relationship || relationship.experience ==='want-to-play'
            a#havePlayedUpdatePlayed.dropbtn( data-game=game.guid data-relationship=relationship?relationship.id:undefined data-experience="played" data-rest=`${relationship? 'PATCH':"POST"}`) Played
          if relationship
            a#deleteRelationship.dropbtn( data-game=game.guid data-relationship=relationship?relationship.id:''  data-rest='DELETE') remove from logs
    else 
      button#logBtn(disabled=!!relationship).dropbtn= "Login to Log"



mixin overviewBox(label, text, icon)
  .overview-box__detail
    svg.overview-box__icon
      use(xlink:href= `/img/icons.svg#icon-${icon}`)
    span.overview-box__label= label
    span.overview-box__text= text

block content
  - const userRelationship = !!user && game.relationships.find(rel => rel.user.id === user.id)
  section.section-description
    .overview-box
      div
        .overview-box__group
          h2.heading-secondary.ma-bt-lg= `${game.name}`

            img(src=`${game.image.medium_url}`)
            //- img(src=`${game.image.screen_url}`)
            //- img(src=`${game.image.screen_large_url}`)
            //- img(src=`${game.image.small_url}`)
            //- img(src=`${game.image.super_url}`)
            //- img(src=`${game.image.thumb_url}`)
            //- img(src=`${game.image.tiny_url}`)
            //- img(src=`${game.image.original_url}`)

          - const date = new Date(game.original_release_date).toLocaleString('en-us',{month: 'long',day:'numeric', year: 'numeric'})
          +overviewBox('Release Date', date, 'calendar')
          //- +overviewBox('Difficulty', tour.difficulty, 'trending-up')
          //- +overviewBox('Participants', `${tour.maxGroupSize} people`, 'user')
          //- +overviewBox('Rating', `${tour.ratingsAverage}/5`, 'star')
        +relationshipButton(user,userRelationship)
  div
    each relationship in game.relationships 
      +reviewCard(relationship)

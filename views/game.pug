extends base 
include _reviewCard




block append head
  //- scripts for leaflet mapping
  link(rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin="")

mixin reviewCard(review)
  hr
  div.activity-container
    h1
      a(href=`/user/${review.user.username}`)= `${review.user.username}`
    h4= `${review.experience}`
    if review.rating 
      h4= `rating: ${review.rating}`
    if review.review 
      h4= `review: ${review.review}`



mixin relationshipButton(user,relationship)
  div.log--container
    if user
      if relationship 
        button#logBtn(disabled).dropbtn= `${relationship.experience}`
      else
        button#logBtn( data-game=game.guid data-experience='want-to-play' data-rest='POST').dropbtn Want to Play
      div.dropdown
        button#dropbtn.dropbtn V
        div#myDropdown.dropdown-content
          if !relationship || relationship.experience ==='played'
            a#wantToPlayUpdate.dropbtn( data-game=game.guid data-relationship=relationship?relationship.id:undefined data-experience="want-to-play" data-rest=`${relationship? 'PATCH':"POST"}`) Want to play
          if !relationship || relationship.experience ==='want-to-play'
            a#havePlayedUpdatePlayed.dropbtn( data-game=game.guid data-relationship=relationship?relationship.id:undefined data-experience="played" data-rest=`${relationship? 'PATCH':"POST"}`) Played
          if relationship
            a#deleteRelationship.dropbtn( data-game=game.guid data-relationship=relationship?relationship.id:''  data-rest='DELETE') remove from logs
    else 
      a(href='/login')#goToLogin.dropbtn= "Login to Log"


mixin overviewBox(label, text, icon)
  .overview-box__detail
    svg.overview-box__icon
      use(xlink:href= `/img/icons.svg#icon-${icon}`)
    span.overview-box__label= label
    span.overview-box__text= text

block content
  - const userRelationship = !!user && game.relationships && game.relationships.find(rel => rel.user.id === user.id)
  - const gameReviews = game.relationships.filter(rel => !!rel.rating)
  section.section-description
    .overview-box
      div
        .overview-box__group.ma-bt-lg
          h2.heading-secondary.ma-bt-lg= `${game.name}`

          img.game__image(src=`${game.image.small_url}`)
        

          - const date = new Date(game.original_release_date).toLocaleString('en-us',{month: 'long',day:'numeric', year: 'numeric'})
          +overviewBox('Release Date', date, 'calendar')
        +relationshipButton(user,userRelationship)
        //- if relationship
          a(href=`/relationship/edit/${relationship.id}`) Review
        if !!userRelationship && userRelationship.experience === 'played'
          a(href=`/relationship/edit/${userRelationship.id}`) Review
  div
    each review in gameReviews 
      +reviewCard(review)
